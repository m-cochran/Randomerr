<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Invaders Game</title>
    <style>
        body { margin: 0; }
        canvas { display: block; margin: auto; background: #000; }
    </style>
</head>
<body>
    <canvas id="spaceInvadersCanvas" width="800" height="600"></canvas>
    <script>
        const canvas = document.getElementById('spaceInvadersCanvas');
        const ctx = canvas.getContext('2d');

        // Game variables
        const player = {
            x: canvas.width / 2 - 25,
            y: canvas.height - 50,
            width: 50,
            height: 10,
            dx: 4
        };

        const bulletSpeed = 5;
        const initialEnemySpeed = 1;
        const enemyRows = 3;
        const enemyCols = 5;
        let enemies = [];
        let bullets = [];
        let score = 0;
        let lives = 3;
        let level = 1;
        let rightPressed = false;
        let leftPressed = false;
        let spacePressed = false;
        let enemyDirection = 1; // 1 for right, -1 for left
        const explosionSound = new Audio('explosion.mp3');
        const shootSound = new Audio('shoot.mp3');
        const gameOverSound = new Audio('gameover.mp3');
        const powerUpSound = new Audio('powerup.mp3');

        // Initialize enemies
        function createEnemies() {
            enemies = [];
            for (let r = 0; r < enemyRows; r++) {
                for (let c = 0; c < enemyCols; c++) {
                    enemies.push({
                        x: c * 60 + 50,
                        y: r * 40 + 30,
                        width: 40,
                        height: 20
                    });
                }
            }
        }

        // Initialize power-ups
        function createPowerUps() {
            if (Math.random() < 0.1) { // 10% chance to spawn a power-up each frame
                powerUps.push({
                    x: Math.random() * (canvas.width - 20),
                    y: 0,
                    width: 20,
                    height: 20,
                    type: 'rapidFire'
                });
            }
        }

        // Draw player
        function drawPlayer() {
            ctx.fillStyle = "#fff";
            ctx.fillRect(player.x, player.y, player.width, player.height);
        }

        // Draw bullets
        function drawBullets() {
            ctx.fillStyle = "#ff0";
            bullets.forEach(bullet => {
                ctx.fillRect(bullet.x, bullet.y, 5, 15);
            });
        }

        // Draw enemies
        function drawEnemies() {
            ctx.fillStyle = "#f00";
            enemies.forEach(enemy => {
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
            });
        }

        // Draw power-ups
        function drawPowerUps() {
            ctx.fillStyle = "#0f0";
            powerUps.forEach(powerUp => {
                ctx.fillRect(powerUp.x, powerUp.y, powerUp.width, powerUp.height);
            });
        }

        // Move player
        function movePlayer() {
            if (rightPressed && player.x < canvas.width - player.width) {
                player.x += player.dx;
            } else if (leftPressed && player.x > 0) {
                player.x -= player.dx;
            }
        }

        // Shoot bullets
        function shootBullet() {
            if (spacePressed) {
                bullets.push({ x: player.x + player.width / 2 - 2.5, y: player.y });
                shootSound.play();
            }
        }

        // Move bullets
        function moveBullets() {
            bullets.forEach((bullet, index) => {
                bullet.y -= bulletSpeed;
                if (bullet.y < 0) {
                    bullets.splice(index, 1);
                }
            });
        }

        // Move enemies
        function moveEnemies() {
            let shouldDrop = false;
            enemies.forEach(enemy => {
                enemy.x += enemySpeed * enemyDirection;
                if (enemy.x + enemy.width > canvas.width || enemy.x < 0) {
                    shouldDrop = true;
                }
            });

            if (shouldDrop) {
                enemyDirection *= -1;
                enemies.forEach(enemy => {
                    enemy.y += 20;
                });
            }
        }

        // Detect collisions
        function detectCollisions() {
            bullets.forEach((bullet, bIndex) => {
                enemies.forEach((enemy, eIndex) => {
                    if (bullet.x < enemy.x + enemy.width &&
                        bullet.x + 5 > enemy.x &&
                        bullet.y < enemy.y + enemy.height &&
                        bullet.y + 15 > enemy.y) {
                        enemies.splice(eIndex, 1);
                        bullets.splice(bIndex, 1);
                        score += 10;
                        explosionSound.play();
                    }
                });
            });

            enemies.forEach((enemy, eIndex) => {
                if (enemy.y + enemy.height > player.y) {
                    lives--;
                    if (lives <= 0) {
                        gameOver();
                    } else {
                        enemies.splice(eIndex, 1);
                        // Optionally reset the player position or do other reset actions
                    }
                }
            });

            powerUps.forEach((powerUp, pIndex) => {
                if (powerUp.y + powerUp.height > player.y &&
                    powerUp.x < player.x + player.width &&
                    powerUp.x + powerUp.width > player.x) {
                    // Power-Up collected
                    powerUps.splice(pIndex, 1);
                    powerUpSound.play();
                    activatePowerUp();
                }
            });
        }

        // Activate power-up
        function activatePowerUp() {
            // Example: Rapid Fire power-up effect
            // You can implement different effects depending on the power-up type
            console.log("Power-Up Activated!");
        }

        // Draw score
        function drawScore() {
            ctx.fillStyle = "#fff";
            ctx.font = "20px Arial";
            ctx.fillText("Score: " + score, 10, 20);
        }

        // Draw lives
        function drawLives() {
            ctx.fillStyle = "#fff";
            ctx.font = "20px Arial";
            ctx.fillText("Lives: " + lives, canvas.width - 100, 20);
        }

        // Draw level
        function drawLevel() {
            ctx.fillStyle = "#fff";
            ctx.font = "20px Arial";
            ctx.fillText("Level: " + level, canvas.width / 2 - 50, 20);
        }

        // Draw game over message
        function gameOver() {
            gameOverSound.play();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#fff";
            ctx.font = "40px Arial";
            ctx.textAlign = "center";
            ctx.fillText("Game Over", canvas.width / 2, canvas.height / 2 - 20);
            ctx.font = "20px Arial";
            ctx.fillText("Score: " + score, canvas.width / 2, canvas.height / 2 + 20);
            document.location.reload(); // Restart the game
        }

        // Main game loop
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (enemies.length === 0) {
                // Advance to next level
                level++;
                createEnemies(); // Increase difficulty
                enemySpeed += 0.5; // Increase enemy speed
                createPowerUps(); // Optionally add more power-ups
            }

            drawPlayer();
            drawBullets();
            drawEnemies();
            drawPowerUps();
            drawScore();
            drawLives();
            drawLevel();

            movePlayer();
            shootBullet();
            moveBullets();
            moveEnemies();
            detectCollisions();
        }

        // Keyboard controls
        document.addEventListener("keydown", function (e) {
            if (e.key === "Right" || e.key === "ArrowRight") {
                rightPressed = true;
            } else if (e.key === "Left" || e.key === "ArrowLeft") {
                leftPressed = true;
            } else if (e.key === " " || e.key === "Spacebar") {
                spacePressed = true;
            }
        });

        document.addEventListener("keyup", function (e) {
            if (e.key === "Right" || e.key === "ArrowRight") {
                rightPressed = false;
            } else if (e.key === "Left" || e.key === "ArrowLeft") {
                leftPressed = false;
            } else if (e.key === " " || e.key === "Spacebar") {
                spacePressed = false;
            }
        });

        createEnemies();
        const powerUps = [];
        let enemySpeed = initialEnemySpeed;
        setInterval(draw, 20);

    </script>
</body>
</html>
